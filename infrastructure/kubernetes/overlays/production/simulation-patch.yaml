# Production patch: Configure Simulation for AWS cloud environment
# - Sets CORS_ORIGINS to production domain (replaces localhost origins)
# - Sets DEPLOYMENT_ENV to production
# - Configures S3 checkpoint storage with full save/restore via IRSA
# - Sets AWS_REGION for IRSA-based S3 access
#
# Note: ConfigMap-based settings are patched separately in configmap-core-patch.yaml.
# These env vars override ConfigMap values because they are set directly on the container.
apiVersion: apps/v1
kind: Deployment
metadata:
  name: simulation
spec:
  template:
    spec:
      containers:
        - name: simulation
          env:
            # Production CORS origins
            - name: CORS_ORIGINS
              value: "https://ridesharing.portfolio.andresbrocco.com,https://control-panel.ridesharing.portfolio.andresbrocco.com"

            # Production deployment environment
            - name: DEPLOYMENT_ENV
              value: "production"

            # Speed multiplier for production demo (8x for observable, real-time-ish pace)
            - name: SIM_SPEED_MULTIPLIER
              value: "8"

            # S3 checkpoint configuration (full save/restore support)
            # SimulationSettings uses env_prefix="SIM_", so all settings need that prefix
            - name: SIM_CHECKPOINT_STORAGE_TYPE
              value: "s3"
            # Replace 962393283188 with AWS account ID during deploy
            - name: SIM_CHECKPOINT_S3_BUCKET
              value: "rideshare-962393283188-checkpoints"
            - name: SIM_CHECKPOINT_S3_PREFIX
              value: "simulation"
            - name: SIM_RESUME_FROM_CHECKPOINT
              value: "true"

            # Ensure AWS region is set for IRSA-based S3 access
            - name: AWS_REGION
              value: "us-east-1"

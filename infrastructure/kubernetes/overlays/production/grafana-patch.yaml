# Production patch: Configure Grafana for subpath serving behind ALB
# - Sets GF_SERVER_ROOT_URL for /grafana subpath
# - Enables GF_SERVER_SERVE_FROM_SUB_PATH
# - Disables anonymous access (require login in production)
apiVersion: apps/v1
kind: Deployment
metadata:
  name: grafana
spec:
  template:
    spec:
      containers:
        - name: grafana
          env:
            # Configure root URL for subpath serving under ALB /grafana
            - name: GF_SERVER_ROOT_URL
              value: "https://api.ridesharing.portfolio.andresbrocco.com/grafana/"

            # Enable serving from subpath
            - name: GF_SERVER_SERVE_FROM_SUB_PATH
              value: "true"

            # Disable anonymous access in production
            - name: GF_AUTH_ANONYMOUS_ENABLED
              value: "false"

{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "-- Grafana --"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "description": "Bronze layer ingestion pipeline monitoring. Tracks event volume across 6 data sources, dead letter queue (DLQ) error rates, ingestion delays, data freshness per table, and detailed error analysis. 24-hour lookback via Trino against Bronze Delta Lake tables.",
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 1,
  "id": null,
  "links": [],
  "liveNow": false,
  "panels": [
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 0
      },
      "id": 1,
      "panels": [],
      "title": "KPI Metrics",
      "type": "row"
    },
    {
      "datasource": {
        "type": "trino-datasource",
        "uid": "trino"
      },
      "description": "Combined event count from all 6 Bronze tables (trips, gps_pings, driver_status, surge_updates, ratings, payments). Overall pipeline throughput indicator.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 4,
        "w": 6,
        "x": 0,
        "y": 1
      },
      "id": 2,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "trino-datasource",
            "uid": "trino"
          },
          "format": 0,
          "rawQuery": true,
          "rawSql": "SELECT (SELECT COUNT(*) FROM delta.bronze.bronze_trips WHERE _ingestion_date >= format_datetime(current_timestamp - INTERVAL '24' HOUR, 'yyyy-MM-dd')) + (SELECT COUNT(*) FROM delta.bronze.bronze_gps_pings WHERE _ingestion_date >= format_datetime(current_timestamp - INTERVAL '24' HOUR, 'yyyy-MM-dd')) + (SELECT COUNT(*) FROM delta.bronze.bronze_driver_status WHERE _ingestion_date >= format_datetime(current_timestamp - INTERVAL '24' HOUR, 'yyyy-MM-dd')) + (SELECT COUNT(*) FROM delta.bronze.bronze_surge_updates WHERE _ingestion_date >= format_datetime(current_timestamp - INTERVAL '24' HOUR, 'yyyy-MM-dd')) + (SELECT COUNT(*) FROM delta.bronze.bronze_ratings WHERE _ingestion_date >= format_datetime(current_timestamp - INTERVAL '24' HOUR, 'yyyy-MM-dd')) + (SELECT COUNT(*) FROM delta.bronze.bronze_payments WHERE _ingestion_date >= format_datetime(current_timestamp - INTERVAL '24' HOUR, 'yyyy-MM-dd')) as total_events",
          "refId": "A"
        }
      ],
      "title": "Total Events (24h)",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "trino-datasource",
        "uid": "trino"
      },
      "description": "Count of records routed to Dead Letter Queue tables due to processing failures. Yellow at 10 errors, red at 50. DLQ captures events that failed validation, parsing, or schema checks.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "yellow",
                "value": 10
              },
              {
                "color": "red",
                "value": 50
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 4,
        "w": 6,
        "x": 6,
        "y": 1
      },
      "id": 3,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "trino-datasource",
            "uid": "trino"
          },
          "format": 0,
          "rawQuery": true,
          "rawSql": "SELECT COUNT(*) as error_count FROM (SELECT _ingestion_date FROM delta.bronze.dlq_trips WHERE _ingestion_date >= format_datetime(current_timestamp - INTERVAL '24' HOUR, 'yyyy-MM-dd') UNION ALL SELECT _ingestion_date FROM delta.bronze.dlq_gps_pings WHERE _ingestion_date >= format_datetime(current_timestamp - INTERVAL '24' HOUR, 'yyyy-MM-dd') UNION ALL SELECT _ingestion_date FROM delta.bronze.dlq_driver_status WHERE _ingestion_date >= format_datetime(current_timestamp - INTERVAL '24' HOUR, 'yyyy-MM-dd') UNION ALL SELECT _ingestion_date FROM delta.bronze.dlq_payments WHERE _ingestion_date >= format_datetime(current_timestamp - INTERVAL '24' HOUR, 'yyyy-MM-dd') UNION ALL SELECT _ingestion_date FROM delta.bronze.dlq_ratings WHERE _ingestion_date >= format_datetime(current_timestamp - INTERVAL '24' HOUR, 'yyyy-MM-dd')) dlq",
          "refId": "A"
        }
      ],
      "title": "DLQ Errors (24h)",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "trino-datasource",
        "uid": "trino"
      },
      "description": "Maximum time gap between event occurrence and Bronze layer ingestion for trip events. Yellow at 300s (5 min), red at 600s (10 min). Indicates pipeline lag.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "decimals": 1,
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "yellow",
                "value": 300
              },
              {
                "color": "red",
                "value": 600
              }
            ]
          },
          "unit": "s"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 4,
        "w": 6,
        "x": 12,
        "y": 1
      },
      "id": 4,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "trino-datasource",
            "uid": "trino"
          },
          "format": 0,
          "rawQuery": true,
          "rawSql": "SELECT MAX(to_unixtime(current_timestamp) - to_unixtime(_ingested_at)) as max_delay_seconds\nFROM delta.bronze.bronze_trips\nWHERE _ingestion_date >= format_datetime(current_timestamp - INTERVAL '24' HOUR, 'yyyy-MM-dd')",
          "refId": "A"
        }
      ],
      "title": "Max Ingestion Delay (s)",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "trino-datasource",
        "uid": "trino"
      },
      "description": "Number of the 6 data source types that have ingested records in the last 24 hours. Expected value is 6 when all sources are active. Values below 6 indicate silent source failures.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "blue",
                "value": null
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 4,
        "w": 6,
        "x": 18,
        "y": 1
      },
      "id": 5,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "textMode": "auto"
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "trino-datasource",
            "uid": "trino"
          },
          "format": 0,
          "rawQuery": true,
          "rawSql": "SELECT COUNT(*) as active_sources FROM (SELECT 'trips' as source FROM delta.bronze.bronze_trips WHERE _ingestion_date >= format_datetime(current_timestamp - INTERVAL '24' HOUR, 'yyyy-MM-dd') UNION SELECT 'gps_pings' FROM delta.bronze.bronze_gps_pings WHERE _ingestion_date >= format_datetime(current_timestamp - INTERVAL '24' HOUR, 'yyyy-MM-dd') UNION SELECT 'driver_status' FROM delta.bronze.bronze_driver_status WHERE _ingestion_date >= format_datetime(current_timestamp - INTERVAL '24' HOUR, 'yyyy-MM-dd') UNION SELECT 'surge_updates' FROM delta.bronze.bronze_surge_updates WHERE _ingestion_date >= format_datetime(current_timestamp - INTERVAL '24' HOUR, 'yyyy-MM-dd') UNION SELECT 'ratings' FROM delta.bronze.bronze_ratings WHERE _ingestion_date >= format_datetime(current_timestamp - INTERVAL '24' HOUR, 'yyyy-MM-dd') UNION SELECT 'payments' FROM delta.bronze.bronze_payments WHERE _ingestion_date >= format_datetime(current_timestamp - INTERVAL '24' HOUR, 'yyyy-MM-dd')) sources",
          "refId": "A"
        }
      ],
      "title": "Active Sources",
      "type": "stat"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 5
      },
      "id": 6,
      "panels": [],
      "title": "Volume Distribution",
      "type": "row"
    },
    {
      "datasource": {
        "type": "trino-datasource",
        "uid": "trino"
      },
      "description": "Donut chart showing relative event volume across the 6 data sources. GPS pings typically dominate due to high-frequency driver location updates.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 6
      },
      "id": 7,
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "right",
          "showLegend": true,
          "values": ["value", "percent"]
        },
        "pieType": "donut",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "trino-datasource",
            "uid": "trino"
          },
          "format": 0,
          "rawQuery": true,
          "rawSql": "SELECT 'trips' as source, COUNT(*) as event_count FROM delta.bronze.bronze_trips WHERE _ingestion_date >= format_datetime(current_timestamp - INTERVAL '24' HOUR, 'yyyy-MM-dd') UNION ALL SELECT 'gps_pings', COUNT(*) FROM delta.bronze.bronze_gps_pings WHERE _ingestion_date >= format_datetime(current_timestamp - INTERVAL '24' HOUR, 'yyyy-MM-dd') UNION ALL SELECT 'driver_status', COUNT(*) FROM delta.bronze.bronze_driver_status WHERE _ingestion_date >= format_datetime(current_timestamp - INTERVAL '24' HOUR, 'yyyy-MM-dd') UNION ALL SELECT 'surge_updates', COUNT(*) FROM delta.bronze.bronze_surge_updates WHERE _ingestion_date >= format_datetime(current_timestamp - INTERVAL '24' HOUR, 'yyyy-MM-dd') UNION ALL SELECT 'ratings', COUNT(*) FROM delta.bronze.bronze_ratings WHERE _ingestion_date >= format_datetime(current_timestamp - INTERVAL '24' HOUR, 'yyyy-MM-dd') UNION ALL SELECT 'payments', COUNT(*) FROM delta.bronze.bronze_payments WHERE _ingestion_date >= format_datetime(current_timestamp - INTERVAL '24' HOUR, 'yyyy-MM-dd') ORDER BY event_count DESC",
          "refId": "A"
        }
      ],
      "title": "Volume by Data Source",
      "type": "piechart"
    },
    {
      "datasource": {
        "type": "trino-datasource",
        "uid": "trino"
      },
      "description": "Distribution of DLQ errors by error classification (validation, parsing, schema mismatch, etc.). Identifies the dominant failure mode for targeted pipeline fixes.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 6
      },
      "id": 8,
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "right",
          "showLegend": true,
          "values": ["value", "percent"]
        },
        "pieType": "donut",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "trino-datasource",
            "uid": "trino"
          },
          "format": 0,
          "rawQuery": true,
          "rawSql": "SELECT error_type, COUNT(*) as error_count FROM (SELECT error_type FROM delta.bronze.dlq_trips WHERE _ingestion_date >= format_datetime(current_timestamp - INTERVAL '24' HOUR, 'yyyy-MM-dd') UNION ALL SELECT error_type FROM delta.bronze.dlq_gps_pings WHERE _ingestion_date >= format_datetime(current_timestamp - INTERVAL '24' HOUR, 'yyyy-MM-dd') UNION ALL SELECT error_type FROM delta.bronze.dlq_driver_status WHERE _ingestion_date >= format_datetime(current_timestamp - INTERVAL '24' HOUR, 'yyyy-MM-dd') UNION ALL SELECT error_type FROM delta.bronze.dlq_payments WHERE _ingestion_date >= format_datetime(current_timestamp - INTERVAL '24' HOUR, 'yyyy-MM-dd') UNION ALL SELECT error_type FROM delta.bronze.dlq_ratings WHERE _ingestion_date >= format_datetime(current_timestamp - INTERVAL '24' HOUR, 'yyyy-MM-dd')) dlq GROUP BY error_type ORDER BY error_count DESC",
          "refId": "A"
        }
      ],
      "title": "DLQ Errors by Type",
      "type": "piechart"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 14
      },
      "id": 9,
      "panels": [],
      "title": "Time Series Trends",
      "type": "row"
    },
    {
      "datasource": {
        "type": "trino-datasource",
        "uid": "trino"
      },
      "description": "Hourly ingestion rate for the top 3 data sources (trips, gps_pings, driver_status). Shows throughput trends and identifies ingestion gaps or spikes.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "Events",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 15,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "smooth",
            "lineWidth": 2,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 15
      },
      "id": 10,
      "options": {
        "legend": {
          "calcs": ["mean", "max"],
          "displayMode": "table",
          "placement": "right",
          "showLegend": true
        },
        "tooltip": {
          "mode": "multi",
          "sort": "desc"
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "trino-datasource",
            "uid": "trino"
          },
          "format": 0,
          "rawQuery": true,
          "rawSql": "SELECT date_trunc('hour', _ingested_at) as time, 'trips' as source, COUNT(*) as events FROM delta.bronze.bronze_trips WHERE _ingested_at >= current_timestamp - INTERVAL '24' HOUR GROUP BY date_trunc('hour', _ingested_at) UNION ALL SELECT date_trunc('hour', _ingested_at), 'gps_pings', COUNT(*) FROM delta.bronze.bronze_gps_pings WHERE _ingested_at >= current_timestamp - INTERVAL '24' HOUR GROUP BY date_trunc('hour', _ingested_at) UNION ALL SELECT date_trunc('hour', _ingested_at), 'driver_status', COUNT(*) FROM delta.bronze.bronze_driver_status WHERE _ingested_at >= current_timestamp - INTERVAL '24' HOUR GROUP BY date_trunc('hour', _ingested_at) ORDER BY time",
          "refId": "A"
        }
      ],
      "title": "Ingestion Rate Over Time",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 23
      },
      "id": 11,
      "panels": [],
      "title": "Distribution & Freshness",
      "type": "row"
    },
    {
      "datasource": {
        "type": "trino-datasource",
        "uid": "trino"
      },
      "description": "Daily event volume for the trips table over the past 7 days. Provides a weekly view of ingestion consistency and volume trends.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "Events",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "bars",
            "fillOpacity": 80,
            "gradientMode": "scheme",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "never",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 24
      },
      "id": 12,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": false
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "trino-datasource",
            "uid": "trino"
          },
          "format": 0,
          "rawQuery": true,
          "rawSql": "SELECT\n  _ingestion_date,\n  COUNT(*) as event_count\nFROM delta.bronze.bronze_trips\nWHERE _ingestion_date >= format_datetime(current_timestamp - INTERVAL '7' DAY, 'yyyy-MM-dd')\nGROUP BY _ingestion_date\nORDER BY _ingestion_date",
          "refId": "A"
        }
      ],
      "title": "Events by Ingestion Date",
      "type": "barchart"
    },
    {
      "datasource": {
        "type": "trino-datasource",
        "uid": "trino"
      },
      "description": "Table showing the most recent ingestion timestamp for each of 8 Bronze tables. Stale timestamps (hours old) indicate ingestion pipeline failures for that source.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          },
          "custom": {
            "align": "auto",
            "displayMode": "auto",
            "inspect": true
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "last_ingestion"
            },
            "properties": [
              {
                "id": "unit",
                "value": "dateTimeAsIso"
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 24
      },
      "id": 13,
      "options": {
        "showHeader": true,
        "cellHeight": "sm",
        "footer": {
          "show": false,
          "reducer": ["sum"],
          "fields": ""
        },
        "sortBy": [
          {
            "desc": true,
            "displayName": "last_ingestion"
          }
        ]
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "trino-datasource",
            "uid": "trino"
          },
          "format": 0,
          "rawQuery": true,
          "rawSql": "SELECT 'bronze_trips' as table_name, MAX(_ingested_at) as last_ingestion FROM delta.bronze.bronze_trips UNION ALL SELECT 'bronze_gps_pings', MAX(_ingested_at) FROM delta.bronze.bronze_gps_pings UNION ALL SELECT 'bronze_driver_status', MAX(_ingested_at) FROM delta.bronze.bronze_driver_status UNION ALL SELECT 'bronze_surge_updates', MAX(_ingested_at) FROM delta.bronze.bronze_surge_updates UNION ALL SELECT 'bronze_ratings', MAX(_ingested_at) FROM delta.bronze.bronze_ratings UNION ALL SELECT 'bronze_payments', MAX(_ingested_at) FROM delta.bronze.bronze_payments UNION ALL SELECT 'bronze_driver_profiles', MAX(_ingested_at) FROM delta.bronze.bronze_driver_profiles UNION ALL SELECT 'bronze_rider_profiles', MAX(_ingested_at) FROM delta.bronze.bronze_rider_profiles ORDER BY last_ingestion DESC",
          "refId": "A"
        }
      ],
      "title": "Data Freshness by Table",
      "type": "table"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 32
      },
      "id": 14,
      "panels": [],
      "title": "Error Analysis",
      "type": "row"
    },
    {
      "datasource": {
        "type": "trino-datasource",
        "uid": "trino"
      },
      "description": "Hourly DLQ error count with a red threshold line at 100 errors/hour. Shows error patterns over time â€” sustained high rates may indicate systemic issues.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "Errors",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 20,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineInterpolation": "smooth",
            "lineWidth": 2,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "line+area"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "transparent",
                "value": null
              },
              {
                "color": "red",
                "value": 100
              }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 33
      },
      "id": 15,
      "options": {
        "legend": {
          "calcs": ["mean", "max", "sum"],
          "displayMode": "table",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "targets": [
        {
          "datasource": {
            "type": "trino-datasource",
            "uid": "trino"
          },
          "format": 0,
          "rawQuery": true,
          "rawSql": "SELECT date_trunc('hour', _ingested_at) as time, COUNT(*) as error_count FROM (SELECT _ingested_at FROM delta.bronze.dlq_trips WHERE _ingested_at >= current_timestamp - INTERVAL '24' HOUR UNION ALL SELECT _ingested_at FROM delta.bronze.dlq_gps_pings WHERE _ingested_at >= current_timestamp - INTERVAL '24' HOUR UNION ALL SELECT _ingested_at FROM delta.bronze.dlq_driver_status WHERE _ingested_at >= current_timestamp - INTERVAL '24' HOUR UNION ALL SELECT _ingested_at FROM delta.bronze.dlq_payments WHERE _ingested_at >= current_timestamp - INTERVAL '24' HOUR UNION ALL SELECT _ingested_at FROM delta.bronze.dlq_ratings WHERE _ingested_at >= current_timestamp - INTERVAL '24' HOUR) dlq GROUP BY date_trunc('hour', _ingested_at) ORDER BY time",
          "refId": "A"
        }
      ],
      "title": "Error Rate Trend",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "trino-datasource",
        "uid": "trino"
      },
      "description": "Detail table of the 50 most recent DLQ records with timestamp, source topic, error type, and error message. Primary debugging tool for pipeline failures.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "thresholds"
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              }
            ]
          },
          "custom": {
            "align": "auto",
            "displayMode": "auto",
            "inspect": true
          }
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "time"
            },
            "properties": [
              {
                "id": "unit",
                "value": "dateTimeAsIso"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "error_message"
            },
            "properties": [
              {
                "id": "custom.width",
                "value": 400
              }
            ]
          }
        ]
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 33
      },
      "id": 16,
      "options": {
        "showHeader": true,
        "cellHeight": "sm",
        "footer": {
          "show": false,
          "reducer": ["sum"],
          "fields": ""
        },
        "sortBy": [
          {
            "desc": true,
            "displayName": "time"
          }
        ]
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "trino-datasource",
            "uid": "trino"
          },
          "format": 0,
          "rawQuery": true,
          "rawSql": "SELECT _ingested_at as time, kafka_topic as source, error_type, error_message FROM (SELECT _ingested_at, kafka_topic, error_type, error_message FROM delta.bronze.dlq_trips WHERE _ingestion_date >= format_datetime(current_timestamp - INTERVAL '24' HOUR, 'yyyy-MM-dd') UNION ALL SELECT _ingested_at, kafka_topic, error_type, error_message FROM delta.bronze.dlq_gps_pings WHERE _ingestion_date >= format_datetime(current_timestamp - INTERVAL '24' HOUR, 'yyyy-MM-dd') UNION ALL SELECT _ingested_at, kafka_topic, error_type, error_message FROM delta.bronze.dlq_driver_status WHERE _ingestion_date >= format_datetime(current_timestamp - INTERVAL '24' HOUR, 'yyyy-MM-dd') UNION ALL SELECT _ingested_at, kafka_topic, error_type, error_message FROM delta.bronze.dlq_payments WHERE _ingestion_date >= format_datetime(current_timestamp - INTERVAL '24' HOUR, 'yyyy-MM-dd') UNION ALL SELECT _ingested_at, kafka_topic, error_type, error_message FROM delta.bronze.dlq_ratings WHERE _ingestion_date >= format_datetime(current_timestamp - INTERVAL '24' HOUR, 'yyyy-MM-dd')) dlq ORDER BY _ingested_at DESC LIMIT 50",
          "refId": "A"
        }
      ],
      "title": "Recent DLQ Errors",
      "type": "table"
    }
  ],
  "refresh": "5m",
  "schemaVersion": 38,
  "style": "dark",
  "tags": ["bronze", "data-engineering", "ingestion"],
  "templating": {
    "list": []
  },
  "time": {
    "from": "now-24h",
    "to": "now"
  },
  "timepicker": {},
  "timezone": "browser",
  "title": "Data Ingestion Monitoring",
  "uid": "data-ingestion-monitoring",
  "version": 1,
  "weekStart": ""
}

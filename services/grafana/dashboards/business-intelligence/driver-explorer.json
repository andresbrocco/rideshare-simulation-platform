{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "-- Grafana --"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "description": "Individual driver deep-dive analytics from Gold and Silver layers. Select a driver from the dropdown to explore trip history, earnings, ratings, offers, activity breakdown, cancellations, and GPS trails. All data queried from Delta Lake via Trino.",
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 1,
  "id": null,
  "links": [],
  "liveNow": false,
  "panels": [
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 },
      "id": 1,
      "panels": [],
      "title": "Driver Overview",
      "type": "row"
    },
    {
      "datasource": { "type": "trino-datasource", "uid": "trino" },
      "description": "Profile details for the selected driver from dim_drivers (SCD Type 2, current record).",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [{ "color": "green", "value": null }]
          },
          "custom": { "align": "auto", "displayMode": "auto", "inspect": true }
        },
        "overrides": []
      },
      "gridPos": { "h": 4, "w": 12, "x": 0, "y": 1 },
      "id": 2,
      "options": {
        "showHeader": true,
        "cellHeight": "sm",
        "footer": { "show": false, "reducer": ["sum"], "fields": "" }
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": { "type": "trino-datasource", "uid": "trino" },
          "format": 0,
          "rawQuery": true,
          "rawSQL": "SELECT\n  first_name || ' ' || last_name AS name,\n  vehicle_make || ' ' || vehicle_model || ' (' || CAST(vehicle_year AS VARCHAR) || ')' AS vehicle,\n  license_plate,\n  shift_preference,\n  home_lat,\n  home_lon\nFROM delta.gold.dim_drivers\nWHERE driver_id = '$driver_id'\n  AND current_flag = TRUE",
          "refId": "A"
        }
      ],
      "title": "Driver Profile",
      "type": "table"
    },
    {
      "datasource": { "type": "trino-datasource", "uid": "trino" },
      "description": "Total number of trips associated with this driver.",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [{ "color": "blue", "value": null }]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": { "h": 4, "w": 3, "x": 12, "y": 1 },
      "id": 3,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "textMode": "auto"
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": { "type": "trino-datasource", "uid": "trino" },
          "format": 0,
          "rawQuery": true,
          "rawSQL": "SELECT COUNT(*) AS trips_completed\nFROM delta.gold.fact_trips ft\nJOIN delta.gold.dim_drivers dd ON ft.driver_key = dd.driver_key\nWHERE dd.driver_id = '$driver_id'\n  AND dd.current_flag = TRUE",
          "refId": "A"
        }
      ],
      "title": "Trips Completed",
      "type": "stat"
    },
    {
      "datasource": { "type": "trino-datasource", "uid": "trino" },
      "description": "Sum of driver_payout from fact_payments for this driver.",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [{ "color": "green", "value": null }]
          },
          "unit": "currencyUSD",
          "decimals": 2
        },
        "overrides": []
      },
      "gridPos": { "h": 4, "w": 3, "x": 15, "y": 1 },
      "id": 4,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "textMode": "auto"
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": { "type": "trino-datasource", "uid": "trino" },
          "format": 0,
          "rawQuery": true,
          "rawSQL": "SELECT COALESCE(SUM(driver_payout), 0) AS total_earnings\nFROM delta.gold.fact_payments fp\nJOIN delta.gold.dim_drivers dd ON fp.driver_key = dd.driver_key\nWHERE dd.driver_id = '$driver_id'\n  AND dd.current_flag = TRUE",
          "refId": "A"
        }
      ],
      "title": "Total Earnings",
      "type": "stat"
    },
    {
      "datasource": { "type": "trino-datasource", "uid": "trino" },
      "description": "Average rating received by this driver. Thresholds: red (<3.5), yellow (3.5-4.0), green (4.0+).",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "decimals": 2,
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "red", "value": null },
              { "color": "yellow", "value": 3.5 },
              { "color": "green", "value": 4.0 }
            ]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": { "h": 4, "w": 3, "x": 18, "y": 1 },
      "id": 5,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "textMode": "auto"
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": { "type": "trino-datasource", "uid": "trino" },
          "format": 0,
          "rawQuery": true,
          "rawSQL": "SELECT ROUND(AVG(CAST(rating AS DOUBLE)), 2) AS avg_rating\nFROM delta.gold.fact_ratings fr\nJOIN delta.gold.dim_drivers dd ON fr.ratee_key = dd.driver_key\nWHERE dd.driver_id = '$driver_id'\n  AND dd.current_flag = TRUE\n  AND fr.ratee_type = 'driver'",
          "refId": "A"
        }
      ],
      "title": "Avg Rating",
      "type": "stat"
    },
    {
      "datasource": { "type": "trino-datasource", "uid": "trino" },
      "description": "Average idle percentage from agg_daily_driver_performance. Idle = (online - en_route - on_trip) / online time.",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "decimals": 1,
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "green", "value": null },
              { "color": "yellow", "value": 20 },
              { "color": "red", "value": 40 }
            ]
          },
          "unit": "percent"
        },
        "overrides": []
      },
      "gridPos": { "h": 4, "w": 3, "x": 21, "y": 1 },
      "id": 6,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "textMode": "auto"
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": { "type": "trino-datasource", "uid": "trino" },
          "format": 0,
          "rawQuery": true,
          "rawSQL": "SELECT ROUND(AVG(idle_pct), 1) AS idle_pct\nFROM delta.gold.agg_daily_driver_performance adp\nJOIN delta.gold.dim_drivers dd ON adp.driver_key = dd.driver_key\nWHERE dd.driver_id = '$driver_id'\n  AND dd.current_flag = TRUE",
          "refId": "A"
        }
      ],
      "title": "Idle %",
      "type": "stat"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 5 },
      "id": 7,
      "panels": [],
      "title": "Performance Trends",
      "type": "row"
    },
    {
      "datasource": { "type": "trino-datasource", "uid": "trino" },
      "description": "Daily trips completed, total payout, and average rating from agg_daily_driver_performance. Payout on right axis (dashed).",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 15,
            "gradientMode": "none",
            "hideFrom": { "legend": false, "tooltip": false, "viz": false },
            "lineInterpolation": "smooth",
            "lineWidth": 2,
            "pointSize": 5,
            "scaleDistribution": { "type": "linear" },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": { "group": "A", "mode": "none" },
            "thresholdsStyle": { "mode": "off" }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [{ "color": "green", "value": null }]
          },
          "unit": "short"
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "total_payout" },
            "properties": [
              { "id": "custom.axisPlacement", "value": "right" },
              { "id": "unit", "value": "currencyUSD" },
              { "id": "custom.lineStyle", "value": { "fill": "dash", "dash": [10, 10] } }
            ]
          }
        ]
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 6 },
      "id": 8,
      "options": {
        "legend": {
          "calcs": ["mean", "max"],
          "displayMode": "table",
          "placement": "right",
          "showLegend": true
        },
        "tooltip": { "mode": "multi", "sort": "desc" }
      },
      "targets": [
        {
          "datasource": { "type": "trino-datasource", "uid": "trino" },
          "format": 0,
          "rawQuery": true,
          "rawSQL": "SELECT\n  CAST(dt.date_key AS TIMESTAMP) AS time,\n  adp.trips_completed,\n  adp.total_payout,\n  adp.avg_rating\nFROM delta.gold.agg_daily_driver_performance adp\nJOIN delta.gold.dim_drivers dd ON adp.driver_key = dd.driver_key\nJOIN delta.gold.dim_time dt ON adp.time_key = dt.time_key\nWHERE dd.driver_id = '$driver_id'\n  AND dd.current_flag = TRUE\nORDER BY time",
          "refId": "A"
        }
      ],
      "title": "Daily KPI Trend",
      "type": "timeseries"
    },
    {
      "datasource": { "type": "trino-datasource", "uid": "trino" },
      "description": "Daily time breakdown by driver status: available, en route to pickup, and on trip. Stacked to show total online time composition.",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "Minutes",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 40,
            "gradientMode": "none",
            "hideFrom": { "legend": false, "tooltip": false, "viz": false },
            "lineInterpolation": "smooth",
            "lineWidth": 2,
            "pointSize": 5,
            "scaleDistribution": { "type": "linear" },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": { "group": "A", "mode": "normal" },
            "thresholdsStyle": { "mode": "off" }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [{ "color": "green", "value": null }]
          },
          "unit": "min"
        },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 6 },
      "id": 9,
      "options": {
        "legend": {
          "calcs": ["sum"],
          "displayMode": "table",
          "placement": "right",
          "showLegend": true
        },
        "tooltip": { "mode": "multi", "sort": "desc" }
      },
      "targets": [
        {
          "datasource": { "type": "trino-datasource", "uid": "trino" },
          "format": 0,
          "rawQuery": true,
          "rawSQL": "SELECT\n  CAST(dt.date_key AS TIMESTAMP) AS time,\n  SUM(CASE WHEN fa.status = 'available' THEN fa.duration_minutes ELSE 0 END) AS available_minutes,\n  SUM(CASE WHEN fa.status = 'en_route_pickup' THEN fa.duration_minutes ELSE 0 END) AS en_route_minutes,\n  SUM(CASE WHEN fa.status = 'on_trip' THEN fa.duration_minutes ELSE 0 END) AS on_trip_minutes\nFROM delta.gold.fact_driver_activity fa\nJOIN delta.gold.dim_drivers dd ON fa.driver_key = dd.driver_key\nJOIN delta.gold.dim_time dt ON fa.time_key = dt.time_key\nWHERE dd.driver_id = '$driver_id'\n  AND dd.current_flag = TRUE\nGROUP BY dt.date_key\nORDER BY time",
          "refId": "A"
        }
      ],
      "title": "Activity Breakdown",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 14 },
      "id": 10,
      "panels": [],
      "title": "Offer & Rating Analysis",
      "type": "row"
    },
    {
      "datasource": { "type": "trino-datasource", "uid": "trino" },
      "description": "Distribution of offer outcomes (accepted, rejected, expired) for this driver.",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [{ "color": "green", "value": null }]
          }
        },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 8, "x": 0, "y": 15 },
      "id": 11,
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "right",
          "showLegend": true,
          "values": ["value", "percent"]
        },
        "pieType": "donut",
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": true },
        "tooltip": { "mode": "single", "sort": "none" }
      },
      "targets": [
        {
          "datasource": { "type": "trino-datasource", "uid": "trino" },
          "format": 0,
          "rawQuery": true,
          "rawSQL": "SELECT\n  outcome,\n  COUNT(*) AS offer_count\nFROM delta.gold.fact_offers\nWHERE driver_id = '$driver_id'\nGROUP BY outcome\nORDER BY offer_count DESC",
          "refId": "A"
        }
      ],
      "title": "Offer Outcomes",
      "type": "piechart"
    },
    {
      "datasource": { "type": "trino-datasource", "uid": "trino" },
      "description": "Average time in seconds for this driver to respond to offers.",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "decimals": 1,
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "green", "value": null },
              { "color": "yellow", "value": 10 },
              { "color": "red", "value": 20 }
            ]
          },
          "unit": "s"
        },
        "overrides": []
      },
      "gridPos": { "h": 4, "w": 4, "x": 8, "y": 15 },
      "id": 12,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "textMode": "auto"
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": { "type": "trino-datasource", "uid": "trino" },
          "format": 0,
          "rawQuery": true,
          "rawSQL": "SELECT ROUND(AVG(CAST(response_seconds AS DOUBLE)), 1) AS avg_response_seconds\nFROM delta.gold.fact_offers\nWHERE driver_id = '$driver_id'\n  AND response_seconds IS NOT NULL",
          "refId": "A"
        }
      ],
      "title": "Avg Response Time",
      "type": "stat"
    },
    {
      "datasource": { "type": "trino-datasource", "uid": "trino" },
      "description": "Daily average response time and offer count. Response time on left axis, count on right axis.",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 15,
            "gradientMode": "none",
            "hideFrom": { "legend": false, "tooltip": false, "viz": false },
            "lineInterpolation": "smooth",
            "lineWidth": 2,
            "pointSize": 5,
            "scaleDistribution": { "type": "linear" },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": { "group": "A", "mode": "none" },
            "thresholdsStyle": { "mode": "off" }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [{ "color": "green", "value": null }]
          },
          "unit": "s"
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "offer_count" },
            "properties": [
              { "id": "custom.axisPlacement", "value": "right" },
              { "id": "unit", "value": "short" }
            ]
          }
        ]
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 15 },
      "id": 13,
      "options": {
        "legend": {
          "calcs": ["mean", "max"],
          "displayMode": "table",
          "placement": "right",
          "showLegend": true
        },
        "tooltip": { "mode": "multi", "sort": "desc" }
      },
      "targets": [
        {
          "datasource": { "type": "trino-datasource", "uid": "trino" },
          "format": 0,
          "rawQuery": true,
          "rawSQL": "SELECT\n  CAST(dt.date_key AS TIMESTAMP) AS time,\n  AVG(CAST(fo.response_seconds AS DOUBLE)) AS avg_response_seconds,\n  COUNT(*) AS offer_count\nFROM delta.gold.fact_offers fo\nJOIN delta.gold.dim_time dt ON fo.time_key = dt.time_key\nWHERE fo.driver_id = '$driver_id'\nGROUP BY dt.date_key\nORDER BY time",
          "refId": "A"
        }
      ],
      "title": "Offer Response Over Time",
      "type": "timeseries"
    },
    {
      "datasource": { "type": "trino-datasource", "uid": "trino" },
      "description": "Distribution of ratings received by this driver (1-5 stars). Uses UNNEST to guarantee all buckets appear.",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "Count",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "bars",
            "fillOpacity": 80,
            "gradientMode": "none",
            "hideFrom": { "legend": false, "tooltip": false, "viz": false },
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": { "type": "linear" },
            "showPoints": "never",
            "spanNulls": false,
            "stacking": { "group": "A", "mode": "none" },
            "thresholdsStyle": { "mode": "off" }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [{ "color": "green", "value": null }]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 6, "x": 0, "y": 23 },
      "id": 14,
      "options": {
        "legend": { "calcs": [], "displayMode": "list", "placement": "bottom", "showLegend": false },
        "tooltip": { "mode": "single", "sort": "none" }
      },
      "targets": [
        {
          "datasource": { "type": "trino-datasource", "uid": "trino" },
          "format": 0,
          "rawQuery": true,
          "rawSQL": "WITH buckets AS (\n  SELECT rating_val, rating_label\n  FROM UNNEST(ARRAY[1,2,3,4,5],\n              ARRAY['1 Star','2 Stars','3 Stars','4 Stars','5 Stars']) AS t(rating_val, rating_label)\n),\nrating_data AS (\n  SELECT CAST(fr.rating AS INTEGER) AS rating_val, COUNT(*) AS rating_count\n  FROM delta.gold.fact_ratings fr\n  JOIN delta.gold.dim_drivers dd ON fr.ratee_key = dd.driver_key\n  WHERE dd.driver_id = '$driver_id'\n    AND dd.current_flag = TRUE\n    AND fr.ratee_type = 'driver'\n  GROUP BY CAST(fr.rating AS INTEGER)\n)\nSELECT b.rating_label AS rating, COALESCE(r.rating_count, 0) AS rating_count\nFROM buckets b LEFT JOIN rating_data r ON b.rating_val = r.rating_val\nORDER BY b.rating_val",
          "refId": "A"
        }
      ],
      "title": "Ratings Received (Distribution)",
      "type": "barchart"
    },
    {
      "datasource": { "type": "trino-datasource", "uid": "trino" },
      "description": "Distribution of ratings given by this driver to riders. Shows how this driver rates others.",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "palette-classic" },
          "custom": {
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "Count",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "bars",
            "fillOpacity": 80,
            "gradientMode": "none",
            "hideFrom": { "legend": false, "tooltip": false, "viz": false },
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": { "type": "linear" },
            "showPoints": "never",
            "spanNulls": false,
            "stacking": { "group": "A", "mode": "none" },
            "thresholdsStyle": { "mode": "off" }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [{ "color": "green", "value": null }]
          },
          "unit": "short"
        },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 6, "x": 6, "y": 23 },
      "id": 15,
      "options": {
        "legend": { "calcs": [], "displayMode": "list", "placement": "bottom", "showLegend": false },
        "tooltip": { "mode": "single", "sort": "none" }
      },
      "targets": [
        {
          "datasource": { "type": "trino-datasource", "uid": "trino" },
          "format": 0,
          "rawQuery": true,
          "rawSQL": "WITH buckets AS (\n  SELECT rating_val, rating_label\n  FROM UNNEST(ARRAY[1,2,3,4,5],\n              ARRAY['1 Star','2 Stars','3 Stars','4 Stars','5 Stars']) AS t(rating_val, rating_label)\n),\nrating_data AS (\n  SELECT CAST(fr.rating AS INTEGER) AS rating_val, COUNT(*) AS rating_count\n  FROM delta.gold.fact_ratings fr\n  JOIN delta.gold.dim_drivers dd ON fr.rater_key = dd.driver_key\n  WHERE dd.driver_id = '$driver_id'\n    AND dd.current_flag = TRUE\n    AND fr.rater_type = 'driver'\n  GROUP BY CAST(fr.rating AS INTEGER)\n)\nSELECT b.rating_label AS rating, COALESCE(r.rating_count, 0) AS rating_count\nFROM buckets b LEFT JOIN rating_data r ON b.rating_val = r.rating_val\nORDER BY b.rating_val",
          "refId": "A"
        }
      ],
      "title": "Ratings Given (Distribution)",
      "type": "barchart"
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 31 },
      "id": 16,
      "panels": [],
      "title": "Trip History & GPS",
      "type": "row"
    },
    {
      "datasource": { "type": "trino-datasource", "uid": "trino" },
      "description": "Recent trips for this driver with rider name, zones, fare, surge, distance, and duration. Limited to 50 most recent.",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [{ "color": "green", "value": null }]
          },
          "custom": { "align": "auto", "displayMode": "auto", "inspect": true }
        },
        "overrides": [
          {
            "matcher": { "id": "byName", "options": "fare" },
            "properties": [
              { "id": "unit", "value": "currencyUSD" },
              { "id": "decimals", "value": 2 }
            ]
          },
          {
            "matcher": { "id": "byName", "options": "distance_km" },
            "properties": [
              { "id": "unit", "value": "km" },
              { "id": "decimals", "value": 1 }
            ]
          }
        ]
      },
      "gridPos": { "h": 8, "w": 24, "x": 0, "y": 32 },
      "id": 17,
      "options": {
        "showHeader": true,
        "cellHeight": "sm",
        "footer": { "show": false, "reducer": ["sum"], "fields": "" },
        "sortBy": [{ "desc": true, "displayName": "completed_at" }]
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": { "type": "trino-datasource", "uid": "trino" },
          "format": 0,
          "rawQuery": true,
          "rawSQL": "SELECT\n  ft.completed_at,\n  dr.first_name || ' ' || dr.last_name AS rider_name,\n  pz.name AS pickup_zone,\n  dz.name AS dropoff_zone,\n  ft.fare,\n  ft.surge_multiplier AS surge,\n  ROUND(ft.distance_km, 1) AS distance_km,\n  ROUND(ft.duration_minutes, 0) AS duration_min\nFROM delta.gold.fact_trips ft\nJOIN delta.gold.dim_drivers dd ON ft.driver_key = dd.driver_key\nJOIN delta.gold.dim_riders dr ON ft.rider_key = dr.rider_key\nLEFT JOIN delta.gold.dim_zones pz ON ft.pickup_zone_key = pz.zone_key\nLEFT JOIN delta.gold.dim_zones dz ON ft.dropoff_zone_key = dz.zone_key\nWHERE dd.driver_id = '$driver_id'\n  AND dd.current_flag = TRUE\nORDER BY ft.completed_at DESC\nLIMIT 50",
          "refId": "A"
        }
      ],
      "title": "Trip History",
      "type": "table"
    },
    {
      "datasource": { "type": "trino-datasource", "uid": "trino" },
      "description": "Cancelled trips involving this driver with reason, stage, and associated rider.",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [{ "color": "green", "value": null }]
          },
          "custom": { "align": "auto", "displayMode": "auto", "inspect": true }
        },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 40 },
      "id": 18,
      "options": {
        "showHeader": true,
        "cellHeight": "sm",
        "footer": { "show": false, "reducer": ["sum"], "fields": "" },
        "sortBy": [{ "desc": true, "displayName": "cancelled_at" }]
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": { "type": "trino-datasource", "uid": "trino" },
          "format": 0,
          "rawQuery": true,
          "rawSQL": "SELECT\n  fc.cancelled_at,\n  dr.first_name || ' ' || dr.last_name AS rider_name,\n  fc.cancellation_reason,\n  fc.cancellation_stage,\n  fc.surge_multiplier AS surge\nFROM delta.gold.fact_cancellations fc\nJOIN delta.gold.dim_drivers dd ON fc.driver_key = dd.driver_key\nLEFT JOIN delta.gold.dim_riders dr ON fc.rider_key = dr.rider_key\nWHERE dd.driver_id = '$driver_id'\n  AND dd.current_flag = TRUE\nORDER BY fc.cancelled_at DESC",
          "refId": "A"
        }
      ],
      "title": "Cancellation Log",
      "type": "table"
    },
    {
      "datasource": { "type": "trino-datasource", "uid": "trino" },
      "description": "GPS ping trail for this driver from the Silver layer. Marker size by speed, color by trip state. Centered on Sao Paulo.",
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "#B4D5E8", "value": null },
              { "color": "#6BAED6", "value": 10 },
              { "color": "#3182BD", "value": 30 },
              { "color": "#08519C", "value": 50 }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 40 },
      "id": 19,
      "options": {
        "basemap": { "config": {}, "name": "Layer 0", "type": "default" },
        "controls": {
          "mouseWheelZoom": true,
          "showAttribution": true,
          "showDebug": false,
          "showMeasure": false,
          "showScale": false,
          "showZoom": true
        },
        "layers": [
          {
            "config": {
              "showLegend": true,
              "style": {
                "color": { "field": "trip_state", "fixed": "dark-green" },
                "opacity": 0.7,
                "rotation": { "fixed": 0, "max": 360, "min": -360, "mode": "mod" },
                "size": { "field": "speed", "fixed": 5, "max": 15, "min": 3 },
                "symbol": { "fixed": "img/icons/marker/circle.svg", "mode": "fixed" }
              }
            },
            "location": {
              "latitude": "latitude",
              "longitude": "longitude",
              "mode": "coords"
            },
            "name": "GPS Pings",
            "tooltip": true,
            "type": "markers"
          }
        ],
        "tooltip": { "mode": "details" },
        "view": { "allLayers": true, "id": "coords", "lat": -23.55, "lon": -46.63, "zoom": 11 }
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": { "type": "trino-datasource", "uid": "trino" },
          "format": 0,
          "rawQuery": true,
          "rawSQL": "SELECT\n  latitude,\n  longitude,\n  speed,\n  trip_state,\n  timestamp\nFROM delta.silver.stg_gps_pings\nWHERE entity_type = 'driver'\n  AND entity_id = '$driver_id'\nORDER BY timestamp\nLIMIT 1000",
          "refId": "A"
        }
      ],
      "title": "GPS Trail",
      "type": "geomap"
    }
  ],
  "refresh": "5m",
  "schemaVersion": 38,
  "style": "dark",
  "tags": ["business-intelligence", "drivers", "gold"],
  "templating": {
    "list": [
      {
        "current": { "selected": false, "text": "", "value": "" },
        "datasource": { "type": "trino-datasource", "uid": "trino" },
        "definition": "SELECT driver_id AS __value, first_name || ' ' || last_name || ' (' || driver_id || ')' AS __text FROM delta.gold.dim_drivers WHERE current_flag = TRUE ORDER BY first_name",
        "hide": 0,
        "includeAll": false,
        "label": "Driver",
        "multi": false,
        "name": "driver_id",
        "options": [],
        "query": "SELECT driver_id AS __value, first_name || ' ' || last_name || ' (' || driver_id || ')' AS __text FROM delta.gold.dim_drivers WHERE current_flag = TRUE ORDER BY first_name",
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "sort": 0,
        "type": "query"
      }
    ]
  },
  "time": {
    "from": "now-7d",
    "to": "now"
  },
  "timepicker": {},
  "timezone": "browser",
  "title": "Driver Explorer",
  "uid": "driver-explorer",
  "version": 1,
  "weekStart": ""
}
